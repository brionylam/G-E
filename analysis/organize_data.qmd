---
title: "Organize Data Notebook"
---

```{r}
#| label: setup
#| include: false

install.packages("mice")
install.packages("VIM")

library(mice)
library(VIM)
library(here)
source(here("utils","check_packages.R"))
source(here("utils","functions.R"))
```

This quarto doc is used to organize the data.

```{r}
#| label: readdata


library(haven)
dts <- read_sav(here("data","data_raw",
                      "osfstorage-archive","CCAM SPSS Data 2008-2022.sav"))

ccam <- subset(dts, 
              select=c("wave","gender","age_category","generation","race","educ_category","income_category","party_x_ideo",
                       "fund_research","reg_CO2_pollutant","discuss_GW",
                    "harm_personally","harm_plants_animals","harm_future_gen","harm_US","harm_dev_countries"))

#"reg_CO2_pollutant" not asked in wave4, "harm_plants_animals" not asked in wave13
ccam <- subset(ccam, wave != 4 & wave != 13)
```

```{r}
#| label: first evaluation of missing value

# Replace 'ccam' with the actual name of your dataset

# Specify the first set of variables of interest
first_set_variables <- c("harm_personally", "harm_plants_animals", "harm_future_gen", "harm_US", "harm_dev_countries")

# Create a function to count "-1" and "0" for a specific variable
count_minus_one_and_zero_values <- function(variable_name) {
  cat("Variable:", variable_name, "\n")
  cat("Number of '-1':", sum(ccam[[variable_name]] == -1), "\n")
  cat("Number of '0':", sum(ccam[[variable_name]] == 0), "\n")
}

# Apply the function to each variable in the first set
lapply(first_set_variables, count_minus_one_and_zero_values)

# Specify the second set of variables of interest
second_set_variables <- c("fund_research", "reg_CO2_pollutant", "discuss_GW")

# Create a function to count "-1" for a specific variable
count_minus_one_values <- function(variable_name) {
  cat("Variable:", variable_name, "\n")
  cat("Number of '-1':", sum(ccam[[variable_name]] == -1), "\n")
}

# Apply the function to each variable in the second set
lapply(second_set_variables, count_minus_one_values)


```

```{r}
#| label: drop missing value

# in this dateset, "-1" menas reject to respond, drop all the "-1"

# "fund_research","reg_CO2_pollutant","discuss_GW",
# "harm_personally","harm_plants_animals","harm_future_gen","harm_US","harm_dev_countries"

ccam <- subset(ccam, fund_research != -1 & reg_CO2_pollutant != -1 & discuss_GW != -1 & 
                 harm_personally != -1 & harm_plants_animals != -1 & harm_future_gen != -1 & harm_US != -1 & harm_dev_countries != -1 )
```

```{r}
#| label:  impute missing values

# in this dateset, "0" means don't know


# Specify the variables for imputation
variables_to_impute <- c("harm_personally", "harm_plants_animals", "harm_future_gen", "harm_US", "harm_dev_countries")

# Mean imputation for variables with missing values coded as "0"
for (variable in variables_to_impute) {
  if (is.numeric(ccam[[variable]])) {
    # Replace "0" with NA
    ccam[[variable]][ccam[[variable]] == 0] <- NA
    
    # Impute with mean for numerical variables
    ccam[[variable]][is.na(ccam[[variable]])] <- mean(ccam[[variable]], na.rm = TRUE)
  }
}

# Check the imputed dataset
head(ccam)



```

```{r}
#| label: merge

ccam$att <- rowSums(ccam[, c("fund_research","reg_CO2_pollutant","discuss_GW","harm_personally", "harm_plants_animals", "harm_future_gen", "harm_US", "harm_dev_countries")])
```

```{r}
#| label: save-data

save(ccam, file=here("data","data_constructed","ccam_data.RData"))
```
